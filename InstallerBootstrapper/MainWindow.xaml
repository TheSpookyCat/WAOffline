<Window x:Class="InstallerBootstrapper.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"

        Title="WA Installer"
        Height="620"
        Width="1024"

        WindowStyle="None"
        ResizeMode="CanMinimize"

        AllowsTransparency="True"
        Background="Transparent"

        SnapsToDevicePixels="True"
        UseLayoutRounding="True">

    <Border
        CornerRadius="18"
        BorderThickness="1"
        BorderBrush="{StaticResource OutlineBrush}"
        Padding="12"
        SnapsToDevicePixels="True">
        <!-- Background="#FF1A1E2D" -->
        <Border.Background>
            <ImageBrush
                ImageSource="/assets/background.png"
                Stretch="UniformToFill"
                AlignmentX="Center"
                AlignmentY="Center" />
        </Border.Background>
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="100"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="92"/>
            </Grid.RowDefinitions>

            <!-- HEADER -->
            <Border Grid.Row="0"
                    Background="{StaticResource ChromeBrush}"
                    CornerRadius="12"
                    Padding="18"
                    MouseDown="DragRegion_OnMouseDown">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel>
                        <TextBlock Text="Worlds Adrift: Offline Installer"
                                   FontFamily="{StaticResource PrimaryFont}"
                                   FontSize="20"
                                   Foreground="{StaticResource OnChrome}"/>

                        <TextBlock Text="All-in-one tool to install and run Worlds Adrift: Offline on your PC."
                                   Foreground="{StaticResource OnSurfaceVariant}"
                                   Margin="0,8,0,0"/>
                    </StackPanel>

                    <StackPanel Grid.Column="1"
                                Orientation="Horizontal">
                        <Button Style="{StaticResource ChromeButtonStyle}"
                                Click="Minimize_OnClick"
                                Content="–"
                                ToolTip="Minimize"
                                Margin="0,0,10,0"/>
                        <Button Style="{StaticResource ChromeButtonStyle}"
                                Click="Close_OnClick"
                                Content="✕"
                                ToolTip="Close"/>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- BODY -->
            <Grid Grid.Row="1"
                  Margin="6">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="2*"/>
                    <ColumnDefinition Width="3*"/>
                </Grid.ColumnDefinitions>

                <!-- LEFT CARD -->
                <Border Style="{StaticResource CardStyle}"
                        Margin="0,0,9,0">
                    <StackPanel>
                        <TextBlock Text="Install destination"
                                   FontFamily="{StaticResource PrimaryFont}"
                                   FontSize="18"
                                   Foreground="{StaticResource OnSurface}"/>

                        <TextBlock TextWrapping="Wrap" Text="Select a preferred install location for Worlds Adrift: Offline."
                                   Foreground="{StaticResource OnSurfaceVariant}"
                                   Margin="0,4,0,16"/>

                        <DockPanel LastChildFill="True">
                            <Button DockPanel.Dock="Right"
                                    Width="120"
                                    Content="Browse"
                                    Style="{StaticResource GhostButtonStyle}"
                                    Command="{Binding BrowseInstallPathCommand}"/>
                            <TextBox Style="{StaticResource InputStyle}"
                                     Text="{Binding InstallPath, UpdateSourceTrigger=PropertyChanged}"
                                     Margin="0,0,12,0"/>
                        </DockPanel>

                        <TextBlock Text="Steam username"
                                   FontFamily="{StaticResource PrimaryFont}"
                                   FontSize="14"
                                   Foreground="{StaticResource OnSurface}"
                                   Margin="0,14,0,4"/>
                        <TextBlock TextWrapping="Wrap"
                                   Text="We only need your Steam account name. Password and Steam Guard will be prompted by DepotDownloader."
                                   Foreground="{StaticResource OnSurfaceVariant}"
                                   Margin="0,0,0,8"/>
                        <TextBox Style="{StaticResource InputStyle}"
                                 Text="{Binding SteamUsername, UpdateSourceTrigger=PropertyChanged}"
                                 ToolTip="Enter your Steam account name"/>

                        <TextBlock TextWrapping="Wrap" Text="{Binding PayloadStatus}"
                                   Foreground="{StaticResource OnSurfaceVariant}"
                                   Margin="0,10,0,0"/>

                        <Separator Margin="0,16,0,16"/>

                        <Button Content="Begin Installation"
                                Style="{StaticResource PrimaryButtonStyle}"
                                Command="{Binding StartInstallCommand}"/>
                    </StackPanel>
                </Border>

                <!-- RIGHT CARD -->
                <Border Grid.Column="1"
                        Style="{StaticResource CardStyle}"
                        Margin="9,0,0,0">

                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- TITLE -->
                        <Grid Grid.Row="0"
                              Margin="0,0,0,16">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Text="Install progress"
                                       FontFamily="{StaticResource PrimaryFont}"
                                       FontSize="18"
                                       Foreground="{StaticResource OnSurface}"/>

                            <Border Grid.Column="1"
                                    Background="#102033"
                                    CornerRadius="8"
                                    Padding="10,4">
                                <TextBlock Text="{Binding CurrentStep, Mode=OneWay}"
                                           Foreground="{Binding CurrentStepBrush, Mode=OneWay}"/>
                            </Border>
                        </Grid>

                        <!-- PROGRESS -->
                        <StackPanel Grid.Row="1"
                                    Margin="0,0,0,16">
                            <ProgressBar Minimum="0"
                                         Maximum="100"
                                         Value="{Binding ProgressPercent, Mode=OneWay}"
                                         Margin="0,0,0,8"/>
                        </StackPanel>

                        <!-- CONSOLE LOG -->
                        <Grid Grid.Row="2">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <Grid Grid.Row="0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <TextBlock Text="Logs"
                                           Foreground="{StaticResource OnSurfaceVariant}"
                                           Margin="0,0,0,8"/>

                                <StackPanel Grid.Column="1"
                                            Orientation="Horizontal"
                                            VerticalAlignment="Bottom">
                                    <Button Content="Retry"
                                            Visibility="{Binding CanRetry, Converter={StaticResource BooleanToVisibilityConverter}}"
                                            Style="{StaticResource HyperlinkButtonStyle}"
                                            Command="{Binding RetryCommand}"
                                            Margin="0,0,10,0"/>
                                    <Button Content="Export logs"
                                            Style="{StaticResource HyperlinkButtonStyle}"
                                            Command="{Binding ExportDiagnosticsCommand}"/>
                                </StackPanel>
                            </Grid>

                            <Border Grid.Row="1"
                                    Background="#8A0B1222"
                                    Padding="12"
                                    BorderBrush="#1E3B68"
                                    BorderThickness="1"
                                    CornerRadius="10">
                                <ScrollViewer x:Name="LogScrollViewer"
                                              VerticalScrollBarVisibility="Auto"
                                              HorizontalScrollBarVisibility="Disabled"
                                              Padding="0,2,4,0">
                                    <ItemsControl ItemsSource="{Binding StatusLog}">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding}"
                                                           TextWrapping="Wrap"
                                                           Foreground="{StaticResource OnSurface}"
                                                           FontFamily="{StaticResource PrimaryFont}"
                                                           FontSize="12"
                                                           Margin="0,0,0,6">
                                                    <!-- <TextBlock.OpacityMask> -->
                                                    <!--     <LinearGradientBrush StartPoint="0,0" EndPoint="1,0"> -->
                                                    <!--         <GradientStop Color="#FFFFFFFF" Offset="0"/> -->
                                                    <!--         <GradientStop Color="#AAFFFFFF" Offset="0.6"/> -->
                                                    <!--         <GradientStop Color="#55FFFFFF" Offset="1"/> -->
                                                    <!--     </LinearGradientBrush> -->
                                                    <!-- </TextBlock.OpacityMask> -->
                                                </TextBlock>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </ScrollViewer>
                            </Border>
                        </Grid>
                    </Grid>
                </Border>
            </Grid>

            <!-- FOOTER -->
            <Border Grid.Row="2"
                    Background="#CC101523"
                    CornerRadius="12"
                    Padding="18"
                    Margin="6"
                    BorderBrush="{StaticResource OutlineBrush}"
                    BorderThickness="1">

                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel>
                        <TextBlock Text="Take to the skies"
                                   Foreground="{StaticResource OnSurface}"
                                   FontFamily="{StaticResource PrimaryFont}"
                                   FontSize="14"/>
                        <TextBlock Text="Your installation progress and launch settings are saved automatically."
                                   Foreground="{StaticResource OnSurfaceVariant}"/>
                    </StackPanel>

                    <StackPanel Grid.Column="1"
                                Orientation="Horizontal">
                        <Button Content="{Binding LaunchButtonText}"
                                Background="{Binding LaunchButtonBackground}"
                                Style="{StaticResource PrimaryButtonStyle}"
                                Command="{Binding LaunchAfterInstallCommand}"/>
                    </StackPanel>
                </Grid>
            </Border>
        </Grid>
    </Border>
</Window>
